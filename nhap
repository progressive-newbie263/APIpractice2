window.addEventListener('DOMContentLoaded', function () {
  // Helper function to get cookie value
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }

  // Get the 'user' cookie
  const userCookie = getCookie('user');
  const user = userCookie ? JSON.parse(userCookie) : null;

  const welcomeMsg = document.getElementById('welcome-msg');
  const authLink = document.getElementById('auth-link');

  const accountDropdown = document.getElementById('accountDropdown');
  const darkOverlay = document.getElementById('darkOverlay');
  const dropdownContent = accountDropdown.querySelector('.dropdown-content');

  if (user) {
    if (user.role === 'admin') {
      window.location.href = 'http://localhost:8082/admin';
    }

    // User is logged in
    welcomeMsg.textContent = `Hello, ${user.name}`;
    authLink.textContent = 'Sign Out'; // Change to 'Sign Out'
    
    // Handle Sign Out
    authLink.addEventListener('click', function () {
      document.cookie = "user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
      
      // Optionally, you can call the logout API as well
      fetch('http://localhost:8082/api/logout', {
        method: 'POST',
        credentials: 'include',
      })
      .then((response) => {
        if (response.ok) {
          location.reload(); // Reload the page after logout
        } else {
          alert('Logout failed');
        }
      });
    });
  } else {
    // User is not logged in
    welcomeMsg.textContent = `Hello, Sign in`;
    authLink.textContent = 'Sign In'; // Change to 'Sign In'

    // Handle Sign In
    authLink.addEventListener('click', function () {
      window.location.href = './sign-in.html'; // Redirect to the login page
    });
  }
});
